<apex:page controller="ProductListController" showHeader="false">
    <apex:form >
        <apex:pageBlock >
            
            <apex:pageBlockSection title="UserList"> 
                <apex:selectList size="1" value="{!SelectedUser}" onchange="showCart()">
                 	<apex:selectOptions value="{!UserList}" />  
                </apex:selectList>   
                <apex:actionFunction action="{!ShowCartList}" name="showCart"/>
            </apex:pageBlockSection>
            
            <apex:outputPanel id="pbId">
                
                <apex:pageBlockSection title="Product List" columns="1" >
                    <apex:pageBlockTable value="{!productList}" var="p" >
                        <apex:column >
                            <apex:commandLink value="{!p.Name}" action="{!getProductDetailPage}" >
                                <apex:param name="detailid" value="{!p.Id}"/>
                            </apex:commandLink>
                        </apex:column>
                        <apex:column value="{!p.Quantity__c}"></apex:column>
                        <apex:column value="{!p.Price__c}"/>
                        <apex:column >
                            <apex:commandLink value="Add" action="{!saveIntoCart}" reRender="CartList">
                                <apex:param name="pid1" value="{!p.Id}"></apex:param>
                            </apex:commandLink>
                        </apex:column>
                    </apex:pageBlockTable>
                </apex:pageBlockSection>
                
                <apex:commandButton status="fetchStatus" reRender="pbId" value="Previous" action="{!setCon.previous}" disabled="{!NOT(setCon.hasPrevious)}" title="Previous  Page"/>
                <apex:commandButton status="fetchStatus" reRender="pbId" value="Next" action="{!setCon.next}"  disabled="{!NOT(setCon.hasNext)}" title="Next Page"/>
            </apex:outputPanel>
            
           <apex:outputPanel id="CartList">
                
               <apex:pageBlockSection title="Cart List" rendered="{!showCartListPanel}" columns="1">
                    <apex:pageBlockTable value="{!Carts}" var="c">
                        <apex:column value="{!c.Product__c}"/>
                        <apex:column >
                            <apex:outputField value="{!c.Quantity__c}">
                                <apex:inlineEditSupport event="ondblClick" showOnEdit="updateButton"/>
                            </apex:outputField>           
                        </apex:column>
                        <apex:column value="{!c.Unit_Price__c}"/>
                        <apex:column value="{!c.Total_Price__c}"/>
                        <apex:column >
                            <apex:commandLink value="X" action="{!deleteFromCart}">
                                <apex:param name="pid2" value="{!c.Product__c}"/>
                            </apex:commandLink>
                        </apex:column>
                    </apex:pageBlockTable>
            	</apex:pageBlockSection>
               
            	<apex:pageBlockSection rendered="{!showCartListPanel}" columns="3">
               		<apex:commandButton value="Proceed to shipping" action="{!proceedToShippingPage}"/>
                	<apex:commandButton id="updateButton" action="{!updateCarts}" value="Update" />
               	</apex:pageBlockSection>
               
       		</apex:outputPanel>
           
      	</apex:pageBlock>
    </apex:form>
</apex:page>